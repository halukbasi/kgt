{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Auth = void 0;\n\nconst uuid_1 = require(\"uuid\");\n\nconst crypto_js_1 = __importDefault(require(\"crypto-js\"));\n\nconst events_1 = require(\"events\");\n\nconst types_1 = require(\"./types\");\n\nconst utils_1 = require(\"./utils\");\n\nclass Auth {\n  constructor(config) {\n    this.config = config;\n    this.userStore = \"particle_user_info\";\n    this.events = new events_1.EventEmitter();\n    this.secretKey = \"\";\n    this._authResult = null;\n    this.uiMode = \"auto\";\n    this.displayCloseButton = true;\n    this.config = config;\n    window.addEventListener(\"message\", event => {\n      if (event.data.name && event.data.name === \"particle-network-provider\" && this._authResult) {\n        const data = this.decrypt(event.data.data);\n\n        if (data.token && data.uuid) {\n          this.setUserInfo(data);\n        }\n\n        if (data.wallets) {\n          const userInfo = this.userInfo();\n\n          if (userInfo) {\n            userInfo.wallets = data.wallets;\n            this.setUserInfo(userInfo);\n          }\n        }\n\n        if (data.error) {\n          if (data.error.code === 8005 || data.error.code === 10005) {\n            this.events.emit(\"disconnect\");\n          }\n\n          this._authResult.reject(data.error);\n        } else {\n          this._authResult.resolve(data);\n        }\n\n        this._authResult.iframe.remove();\n\n        this._authResult = null;\n        const container = document.getElementById(\"particle-network-container\");\n\n        if (container) {\n          container.style.display = \"none\";\n        }\n      }\n    });\n  }\n\n  login(config) {\n    var _a;\n\n    const iframe = this.getIframe();\n    iframe.src = this.buildUrl(\"/login\", {\n      login_type: config === null || config === void 0 ? void 0 : config.preferredAuthType,\n      support_auth_types: (_a = config === null || config === void 0 ? void 0 : config.supportAuthTypes) !== null && _a !== void 0 ? _a : types_1.AuthTypes.join(\",\")\n    });\n    return new Promise((resolve, reject) => {\n      this.setAuthResult({\n        resolve: value => {\n          this.events.emit(\"connect\", value);\n          resolve(value);\n        },\n        reject,\n        iframe\n      });\n    });\n  }\n\n  logout() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const iframe = this.getIframe();\n      iframe.src = this.buildUrl(\"/logout\");\n      return new Promise((resolve, reject) => {\n        this.setAuthResult({\n          resolve: () => {\n            this.setUserInfo(null);\n            this.events.emit(\"disconnect\");\n            resolve();\n          },\n          reject,\n          iframe\n        });\n      });\n    });\n  }\n\n  sign(method, message) {\n    var _a, _b;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.walletExist()) {\n        return Promise.reject(types_1.AuthError.walletNotCreated());\n      }\n\n      const iframe = this.getIframe();\n\n      if (this.config.chainName === \"solana\") {\n        iframe.src = this.buildUrl(\"/solana/sign\", {\n          token: (_a = this.userInfo()) === null || _a === void 0 ? void 0 : _a.token,\n          method: method,\n          chain_id: Number(this.config.chainId),\n          message: message\n        });\n      } else {\n        iframe.src = this.buildUrl(\"/evm-chain/sign\", {\n          token: (_b = this.userInfo()) === null || _b === void 0 ? void 0 : _b.token,\n          method: method,\n          chain_id: Number(this.config.chainId),\n          message: message\n        });\n      }\n\n      return new Promise((resolve, reject) => {\n        this.setAuthResult({\n          resolve: value => {\n            var _a;\n\n            resolve((_a = value.signature) !== null && _a !== void 0 ? _a : \"\");\n          },\n          reject,\n          iframe\n        });\n      });\n    });\n  }\n\n  signAllTransactions(messages) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.walletExist()) {\n        return Promise.reject(types_1.AuthError.walletNotCreated());\n      }\n\n      if (this.config.chainName !== \"solana\") {\n        return Promise.reject(types_1.AuthError.unsupportedMethod());\n      }\n\n      const result = yield this.sign(\"signAllTransactions\", JSON.stringify(messages));\n      const signatures = JSON.parse(result);\n      return signatures;\n    });\n  }\n\n  sendTransaction(message) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      if (!this.walletExist()) {\n        return Promise.reject(types_1.AuthError.walletNotCreated());\n      }\n\n      if (this.config.chainName === \"solana\") {\n        return this.sign(\"signAndSendTransaction\", message);\n      } else {\n        const iframe = this.getIframe();\n        iframe.src = this.buildUrl(\"/evm-chain/sign\", {\n          token: (_a = this.userInfo()) === null || _a === void 0 ? void 0 : _a.token,\n          method: \"eth_sendTransaction\",\n          chain_id: Number(this.config.chainId),\n          message: message\n        });\n        return new Promise((resolve, reject) => {\n          this.setAuthResult({\n            resolve: value => {\n              var _a;\n\n              resolve((_a = value.signature) !== null && _a !== void 0 ? _a : \"\");\n            },\n            reject,\n            iframe\n          });\n        });\n      }\n    });\n  }\n\n  setChainInfo(chain) {\n    const userInfo = this.userInfo();\n\n    if (!userInfo) {\n      return Promise.reject(types_1.AuthError.notLogin());\n    }\n\n    if (typeof chain.name !== \"string\" || typeof chain.id !== \"number\") {\n      throw types_1.AuthError.paramsError();\n    }\n\n    if (!Object.keys(types_1.supportChains).includes(chain.name)) {\n      throw types_1.AuthError.unsupportedChain();\n    }\n\n    const chainName = chain.name;\n\n    if (!types_1.supportChains[chainName].includes(chain.id)) {\n      throw types_1.AuthError.unsupportedChain();\n    }\n\n    const wallets = userInfo.wallets;\n\n    if (this.config.chainName === chain.name && this.config.chainId === chain.id) {\n      return Promise.resolve(wallets);\n    }\n\n    const wallet = this.wallet(chainName === \"solana\" ? \"solana\" : \"evm_chain\");\n\n    if (wallet) {\n      this.config.chainName = chain.name;\n      this.config.chainId = chain.id;\n      this.events.emit(\"chainChanged\", chain);\n      return Promise.resolve(wallets);\n    } //create wallet\n\n\n    const iframe = this.getIframe();\n    iframe.src = this.buildUrl(\"/wallet\", {\n      token: userInfo.token,\n      chain_name: chain.name\n    });\n    return new Promise((resolve, reject) => {\n      this.setAuthResult({\n        resolve: value => {\n          this.config.chainName = chain.name;\n          this.config.chainId = chain.id;\n          this.events.emit(\"connect\", this.userInfo());\n          this.events.emit(\"chainChanged\", chain);\n          resolve(value);\n        },\n        reject,\n        iframe\n      });\n    });\n  }\n\n  chainId() {\n    return this.config.chainId;\n  }\n\n  basicCredentials() {\n    return `Basic ${Buffer.from(`${this.config.projectId}:${this.config.clientKey}`, \"utf8\").toString(\"base64\")}`;\n  }\n\n  isLogin() {\n    return this.userInfo() !== null;\n  }\n\n  userInfo() {\n    const info = window.localStorage.getItem(this.userStore);\n    return info ? JSON.parse(info) : null;\n  }\n\n  walletExist() {\n    return this.wallet() != null;\n  }\n\n  wallet(chainType) {\n    const userInfo = this.userInfo();\n\n    if (!userInfo) {\n      return null;\n    }\n\n    const wallet = userInfo.wallets.find(wallet => wallet.chain_name === (chainType || this.walletChainName()));\n\n    if (wallet !== undefined && wallet.public_address.length > 0) {\n      return wallet;\n    }\n\n    return null;\n  }\n\n  setAuthTheme(config) {\n    if (config.uiMode) {\n      this.uiMode = config.uiMode;\n    }\n\n    if (config.displayCloseButton !== null && config.displayCloseButton !== undefined) {\n      this.displayCloseButton = config.displayCloseButton;\n    }\n  }\n\n  on(event, listener) {\n    this.events.on(event, listener);\n  }\n\n  once(event, listener) {\n    this.events.once(event, listener);\n  }\n\n  off(event, listener) {\n    this.events.off(event, listener);\n  }\n\n  removeListener(event, listener) {\n    this.events.removeListener(event, listener);\n  }\n\n  walletChainName() {\n    return this.config.chainName === \"solana\" ? \"solana\" : \"evm_chain\";\n  }\n\n  setAuthResult(authResult) {\n    if (this._authResult) {\n      this._authResult.reject(types_1.AuthError.userCancelOperation());\n    }\n\n    this._authResult = authResult;\n  }\n\n  setUserInfo(info) {\n    if (info) {\n      window.localStorage.setItem(this.userStore, JSON.stringify(info));\n    } else {\n      window.localStorage.removeItem(this.userStore);\n    }\n  }\n\n  getIframe() {\n    let containerDiv = document.getElementById(\"particle-network-container\");\n\n    if (!containerDiv) {\n      containerDiv = document.createElement(\"div\");\n      containerDiv.setAttribute(\"style\", \"display: block;position: fixed;top: 0px;right: 0px;width: 100%;height: 100%;border-radius: 0px;border: none;z-index: 2147483647;background-color: rgba(0, 0, 0, 0.5);align-items: center;\");\n      containerDiv.id = \"particle-network-container\";\n      document.body.appendChild(containerDiv);\n    } else {\n      containerDiv.style.display = \"block\";\n    }\n\n    let iframe;\n    const elements = document.getElementsByName(\"particle-network-iframe\");\n\n    if (elements.length > 0) {\n      iframe = elements[0];\n      iframe.style.display = \"\";\n    } else {\n      iframe = document.createElement(\"iframe\");\n      iframe.name = \"particle-network-iframe\";\n      iframe.setAttribute(\"style\", \"position: absolute;left: 50%;top: 50%;transform: translate(-50%, -50%);width: 400px;height: 650px;border-radius: 0px;border: none;z-index: 2147483647;box-shadow: -1px 3px 11px 2px #00000073;border-radius: 10px;background-color: #FFFFFF\");\n      containerDiv.appendChild(iframe);\n    }\n\n    return iframe;\n  }\n\n  buildUrl(path) {\n    let extraParams = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    var _a;\n\n    const schema = (_a = this.config.authUrl) !== null && _a !== void 0 ? _a : \"https://auth.particle.network\";\n    const params = {\n      project_uuid: this.config.projectId,\n      project_client_key: this.config.clientKey,\n      project_app_uuid: this.config.appId,\n      chain_name: this.config.chainName,\n      sdk_version: (0, utils_1.getVersion)(),\n      device_id: (0, utils_1.getDeviceId)(),\n      theme_type: this.uiMode === \"auto\" ? window.matchMedia && window.matchMedia(\"(prefers-color-scheme: dark)\").matches ? \"dark\" : \"light\" : this.uiMode,\n      display_close_button: this.displayCloseButton\n    };\n    Object.assign(params, Object.assign({}, extraParams));\n    this.secretKey = (0, uuid_1.v4)().replace(/-/g, \"\").toUpperCase();\n    const keyWA = crypto_js_1.default.enc.Utf8.parse(this.secretKey);\n    const cipherText = crypto_js_1.default.AES.encrypt(JSON.stringify(params), keyWA, {\n      mode: crypto_js_1.default.mode.ECB,\n      algorithm: crypto_js_1.default.algo.AES,\n      padding: crypto_js_1.default.pad.Pkcs7,\n      formatter: crypto_js_1.default.format.Hex\n    }).ciphertext;\n    const value = encodeURIComponent(crypto_js_1.default.enc.Base64.stringify(cipherText)) + this.secretKey;\n    const url = `${schema}?params=${value}&encoding=base64#${path}`;\n    return url;\n  }\n\n  decrypt(data) {\n    const dec = crypto_js_1.default.enc.Hex.parse(data);\n    const keyWA = crypto_js_1.default.enc.Utf8.parse(this.secretKey);\n    const bytes = crypto_js_1.default.AES.decrypt(crypto_js_1.default.lib.CipherParams.create({\n      ciphertext: dec,\n      key: keyWA,\n      algorithm: crypto_js_1.default.algo.AES,\n      padding: crypto_js_1.default.pad.Pkcs7,\n      formatter: crypto_js_1.default.format.Hex\n    }), keyWA, {\n      mode: crypto_js_1.default.mode.ECB\n    });\n    return JSON.parse(bytes.toString(crypto_js_1.default.enc.Utf8));\n  }\n\n}\n\nexports.Auth = Auth;","map":{"version":3,"mappings":"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","names":["Auth","constructor","config","events_1","window","addEventListener","event","data","name","_authResult","decrypt","token","uuid","setUserInfo","wallets","userInfo","error","code","events","emit","reject","resolve","iframe","remove","container","document","getElementById","style","display","login","getIframe","src","buildUrl","login_type","preferredAuthType","support_auth_types","supportAuthTypes","_a","types_1","join","Promise","setAuthResult","value","logout","sign","method","message","walletExist","walletNotCreated","chainName","chain_id","Number","chainId","_b","signature","signAllTransactions","messages","unsupportedMethod","result","JSON","stringify","signatures","parse","sendTransaction","setChainInfo","chain","notLogin","id","paramsError","Object","keys","includes","unsupportedChain","wallet","chain_name","basicCredentials","Buffer","from","projectId","clientKey","toString","isLogin","info","localStorage","getItem","userStore","chainType","find","walletChainName","undefined","public_address","length","setAuthTheme","uiMode","displayCloseButton","on","listener","once","off","removeListener","authResult","userCancelOperation","setItem","removeItem","containerDiv","createElement","setAttribute","body","appendChild","elements","getElementsByName","path","extraParams","schema","authUrl","params","project_uuid","project_client_key","project_app_uuid","appId","sdk_version","device_id","theme_type","matchMedia","matches","display_close_button","assign","secretKey","replace","toUpperCase","keyWA","crypto_js_1","enc","Utf8","cipherText","AES","encrypt","mode","ECB","algorithm","algo","padding","pad","Pkcs7","formatter","format","Hex","ciphertext","encodeURIComponent","Base64","url","dec","bytes","lib","CipherParams","create","key","exports"],"sourceRoot":"","sources":["../src/auth.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}