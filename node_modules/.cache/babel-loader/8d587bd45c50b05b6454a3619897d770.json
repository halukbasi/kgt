{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.LedgerWalletAdapter = exports.LedgerWalletName = void 0;\n\nconst wallet_adapter_base_1 = require(\"@solana/wallet-adapter-base\");\n\nrequire(\"./polyfills/index\");\n\nconst util_1 = require(\"./util\");\n\nexports.LedgerWalletName = 'Ledger';\n\nclass LedgerWalletAdapter extends wallet_adapter_base_1.BaseSignerWalletAdapter {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this.name = exports.LedgerWalletName;\n    this.url = 'https://ledger.com';\n    this.icon = 'data:image/svg+xml;base64,PHN2ZyB2aWV3Qm94PSIwIDAgMzUgMzUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PGcgZmlsbD0iI2ZmZiI+PHBhdGggZD0ibTIzLjU4OCAwaC0xNnYyMS41ODNoMjEuNnYtMTZhNS41ODUgNS41ODUgMCAwIDAgLTUuNi01LjU4M3oiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUuNzM5KSIvPjxwYXRoIGQ9Im04LjM0MiAwaC0yLjc1N2E1LjU4NSA1LjU4NSAwIDAgMCAtNS41ODUgNS41ODV2Mi43NTdoOC4zNDJ6Ii8+PHBhdGggZD0ibTAgNy41OWg4LjM0MnY4LjM0MmgtOC4zNDJ6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDUuNzM5KSIvPjxwYXRoIGQ9Im0xNS4xOCAyMy40NTFoMi43NTdhNS41ODUgNS41ODUgMCAwIDAgNS41ODUtNS42di0yLjY3MWgtOC4zNDJ6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgxMS40NzggMTEuNDc4KSIvPjxwYXRoIGQ9Im03LjU5IDE1LjE4aDguMzQydjguMzQyaC04LjM0MnoiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDUuNzM5IDExLjQ3OCkiLz48cGF0aCBkPSJtMCAxNS4xOHYyLjc1N2E1LjU4NSA1LjU4NSAwIDAgMCA1LjU4NSA1LjU4NWgyLjc1N3YtOC4zNDJ6IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSgwIDExLjQ3OCkiLz48L2c+PC9zdmc+';\n    this._readyState = typeof window === 'undefined' || typeof document === 'undefined' || typeof navigator === 'undefined' || !navigator.hid ? wallet_adapter_base_1.WalletReadyState.Unsupported : wallet_adapter_base_1.WalletReadyState.Loadable;\n\n    this._disconnected = () => {\n      const transport = this._transport;\n\n      if (transport) {\n        transport.off('disconnect', this._disconnected);\n        this._transport = null;\n        this._publicKey = null;\n        this.emit('error', new wallet_adapter_base_1.WalletDisconnectedError());\n        this.emit('disconnect');\n      }\n    };\n\n    this._derivationPath = config.derivationPath || (0, util_1.getDerivationPath)(0, 0);\n    this._connecting = false;\n    this._transport = null;\n    this._publicKey = null;\n  }\n\n  get publicKey() {\n    return this._publicKey;\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get readyState() {\n    return this._readyState;\n  }\n\n  connect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        if (this.connected || this.connecting) return;\n        if (this._readyState !== wallet_adapter_base_1.WalletReadyState.Loadable) throw new wallet_adapter_base_1.WalletNotReadyError();\n        this._connecting = true;\n        let TransportWebHIDClass;\n\n        try {\n          ({\n            default: TransportWebHIDClass\n          } = yield Promise.resolve().then(() => __importStar(require('@ledgerhq/hw-transport-webhid'))));\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletLoadError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        let transport;\n\n        try {\n          transport = yield TransportWebHIDClass.create();\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletConnectionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        let publicKey;\n\n        try {\n          publicKey = yield (0, util_1.getPublicKey)(transport, this._derivationPath);\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletPublicKeyError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        transport.on('disconnect', this._disconnected);\n        this._transport = transport;\n        this._publicKey = publicKey;\n        this.emit('connect', publicKey);\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const transport = this._transport;\n\n      if (transport) {\n        transport.off('disconnect', this._disconnected);\n        this._transport = null;\n        this._publicKey = null;\n\n        try {\n          yield transport.close();\n        } catch (error) {\n          this.emit('error', new wallet_adapter_base_1.WalletDisconnectionError(error === null || error === void 0 ? void 0 : error.message, error));\n        }\n      }\n\n      this.emit('disconnect');\n    });\n  }\n\n  signTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const transport = this._transport;\n        const publicKey = this._publicKey;\n        if (!transport || !publicKey) throw new wallet_adapter_base_1.WalletNotConnectedError();\n\n        try {\n          const signature = yield (0, util_1.signTransaction)(transport, transaction, this._derivationPath);\n          transaction.addSignature(publicKey, signature);\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        return transaction;\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n}\n\nexports.LedgerWalletAdapter = LedgerWalletAdapter;","map":{"version":3,"mappings":"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","names":["require","exports","LedgerWalletAdapter","wallet_adapter_base_1","constructor","config","window","document","navigator","hid","Unsupported","Loadable","transport","_transport","off","_disconnected","_publicKey","emit","_derivationPath","derivationPath","_connecting","publicKey","connecting","readyState","_readyState","connect","connected","TransportWebHIDClass","default","error","message","create","on","disconnect","close","signTransaction","transaction","signature","addSignature"],"sourceRoot":"","sources":["../../src/adapter.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}