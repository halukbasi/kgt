{"ast":null,"code":"\"use strict\";\n\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\n\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\n\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n\n  __setModuleDefault(result, mod);\n\n  return result;\n};\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.KeystoneWalletAdapter = exports.KeystoneWalletName = void 0;\n\nconst wallet_adapter_base_1 = require(\"@solana/wallet-adapter-base\");\n\nconst web3_js_1 = require(\"@solana/web3.js\");\n\nexports.KeystoneWalletName = 'Keystone';\n\nclass KeystoneWalletAdapter extends wallet_adapter_base_1.BaseMessageSignerWalletAdapter {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this.name = exports.KeystoneWalletName;\n    this.url = 'https://keyst.one';\n    this.icon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KICAgIDxjaXJjbGUgY3g9IjE2IiBjeT0iMTYiIHI9IjE2IiBmaWxsPSJ3aGl0ZSIvPgogICAgPHJlY3QgeD0iNSIgeT0iNSIgd2lkdGg9IjIyIiBoZWlnaHQ9IjIyIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIxIi8+CiAgICA8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZD0iTTE0LjY5NjUgNS40MzQ4N0MxNS4wOTEgNC43NTMxNiAxNi4wNzQ5IDQuNzUyMTEgMTYuNDcwOCA1LjQzMjk5TDE3LjMzOTggNi45MjcxOUMxNy42NDkgNy40NTg5NiAxNy42NDg3IDguMTE1ODggMTcuMzM4OSA4LjY0NzM0TDkuNjMxMjEgMjEuODcxQzkuMjE4NTEgMjIuNTc5MSA4LjE5NjIzIDIyLjU4MTEgNy43ODA3NiAyMS44NzQ2QzcuNzMxMzIgMjEuNzkwNiA3LjY5MzU4IDIxLjcwMDEgNy42Njg1OCAyMS42MDU4TDcuMzcwODggMjAuNDgyOUM3LjA5MjY2IDE5LjQzMzQgNy4yNDE4IDE4LjMxNjQgNy43ODU2MyAxNy4zNzY3TDE0LjY5NjUgNS40MzQ4N1pNMTIuNjYzNiAxOS4yODU4QzEzLjA2MzUgMTguNTk5NyAxNC4wMDM1IDE4LjQ3NTcgMTQuNTY3NyAxOS4wMzQ1TDE3LjQyODggMjEuODY4NkMxOC44NjA1IDIzLjI4NjcgMTguODU2NSAyNS42MDE2IDE3LjQyIDI3LjAxNDlDMTcuMjA0NSAyNy4yMjY5IDE2Ljg3OTggMjcuMjgyNSAxNi42MDYgMjcuMTU0MkwxMS42MDAyIDI0LjgwODFDMTAuNjkwNyAyNC4zODE5IDEwLjM0MyAyMy4yNjcxIDEwLjg0ODcgMjIuMzk5NEwxMi42NjM2IDE5LjI4NThaTTIwLjQzNSAxNi4zMzcyQzIxLjQ4OTcgMTYuMzM3MiAyMi4xNDc0IDE1LjE5MzkgMjEuNjE3MiAxNC4yODIyTDE5Ljc4MjggMTEuMTI4QzE5LjI1NTggMTAuMjIxOCAxNy45NDcxIDEwLjIyMTIgMTcuNDE5MiAxMS4xMjY5TDE1LjQzMDkgMTQuNTM4MUMxNC45NjYgMTUuMzM1OCAxNS41NDE0IDE2LjMzNzIgMTYuNDY0NyAxNi4zMzcyTDIwLjQzNSAxNi4zMzcyWiIgZmlsbD0iYmxhY2siLz4KICAgIDxwYXRoIGZpbGwtcnVsZT0iZXZlbm9kZCIgY2xpcC1ydWxlPSJldmVub2RkIiBkPSJNMjEuNzMwMyAxNy42NDU5QzIyLjg3MTMgMTcuNjQ1OSAyMy45MjYxIDE4LjI1MjcgMjQuNDk5OCAxOS4yMzlWMTkuMjM5QzI0LjY3NjMgMTkuNTQyNyAyNC42MjQ3IDE5LjkyNzQgMjQuMzc0MyAyMC4xNzM3TDIyLjA1MTEgMjIuNDU5QzIxLjQ1MDkgMjMuMDQ5NCAyMC40ODc3IDIzLjA0NzggMTkuODg5NSAyMi40NTUzTDE2LjUxMDEgMTkuMTA3OEMxNS45Njc3IDE4LjU3MDYgMTYuMzQ4MSAxNy42NDU5IDE3LjExMTYgMTcuNjQ1OUwyMS43MzAzIDE3LjY0NTlaIiBmaWxsPSIjMjE2MUZGIi8+Cjwvc3ZnPgo=';\n    this._readyState = typeof window === 'undefined' || typeof document === 'undefined' ? wallet_adapter_base_1.WalletReadyState.Unsupported : wallet_adapter_base_1.WalletReadyState.Loadable;\n    this._keyring = null;\n    this._publicKey = null;\n    this._connecting = false;\n  }\n\n  connect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        if (this.connected || this.connecting) return;\n        if (this._readyState !== wallet_adapter_base_1.WalletReadyState.Loadable) throw new wallet_adapter_base_1.WalletNotReadyError();\n        this._connecting = true;\n        let keyring;\n\n        try {\n          const {\n            DefaultKeyring\n          } = yield Promise.resolve().then(() => __importStar(require('@keystonehq/sol-keyring')));\n          keyring = DefaultKeyring.getEmptyKeyring();\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletLoadError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        let account;\n\n        try {\n          yield keyring.readKeyring();\n          account = keyring.getAccounts()[0].pubKey;\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletAccountError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        let publicKey;\n\n        try {\n          publicKey = new web3_js_1.PublicKey(account);\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletPublicKeyError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        this._keyring = keyring;\n        this._publicKey = publicKey;\n        this.emit('connect', publicKey);\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._keyring) {\n        this._keyring = null;\n        this._publicKey = null;\n      }\n\n      this.emit('disconnect');\n    });\n  }\n\n  get publicKey() {\n    return this._publicKey;\n  }\n\n  get readyState() {\n    return this._readyState;\n  }\n\n  signTransaction(transaction) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const keyring = this._keyring;\n        const publicKey = (_a = this._publicKey) === null || _a === void 0 ? void 0 : _a.toString();\n        if (!keyring || !publicKey) throw new wallet_adapter_base_1.WalletNotConnectedError();\n\n        try {\n          return keyring.signTransaction(publicKey, transaction);\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n  signMessage(message) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const keyring = this._keyring;\n        const publicKey = (_a = this._publicKey) === null || _a === void 0 ? void 0 : _a.toString();\n        if (!keyring || !publicKey) throw new wallet_adapter_base_1.WalletNotConnectedError();\n\n        try {\n          return keyring.signMessage(publicKey, message);\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n}\n\nexports.KeystoneWalletAdapter = KeystoneWalletAdapter;","map":{"version":3,"mappings":"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","names":["exports","KeystoneWalletAdapter","wallet_adapter_base_1","constructor","config","window","document","Unsupported","Loadable","_keyring","_publicKey","_connecting","connect","connected","connecting","_readyState","keyring","DefaultKeyring","getEmptyKeyring","error","message","account","readKeyring","getAccounts","pubKey","publicKey","web3_js_1","emit","disconnect","readyState","signTransaction","transaction","_a","toString","signMessage"],"sourceRoot":"","sources":["../../src/adapter.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}