{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports[\"default\"] = void 0;\nexports.getSocketInstance = getSocketInstance;\nexports.keccak256 = keccak256;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.setupSocketConnection = setupSocketConnection;\nexports.storageKey = storageKey;\nexports.type = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _socket = require(\"socket.io-client\");\n\nvar _eccrypto = require(\"@toruslabs/eccrypto\");\n\nvar _metadataHelpers = require(\"@toruslabs/metadata-helpers\");\n\nvar _keccak = _interopRequireDefault(require(\"keccak\"));\n\nvar _util = require(\"../util\");\n\nvar _options = require(\"../options\");\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\n\n\nvar microSeconds = _util.microSeconds; // PASS IN STRING/BUFFER TO GET BUFFER\n\nexports.microSeconds = microSeconds;\n\nfunction keccak256(a) {\n  return (0, _keccak[\"default\"])('keccak256').update(a).digest();\n}\n\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'server';\nexports.type = type;\nvar SOCKET_CONN_INSTANCE = null;\n\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\n\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res, rej) {\n    (0, _util.sleep)().then( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n      var key, channelEncPrivKey, encData, body;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              key = storageKey(channelState.channelName);\n              channelEncPrivKey = keccak256(key);\n              _context.next = 4;\n              return (0, _metadataHelpers.encryptData)(channelEncPrivKey.toString('hex'), {\n                token: (0, _util.randomToken)(),\n                time: new Date().getTime(),\n                data: messageJson,\n                uuid: channelState.uuid\n              });\n\n            case 4:\n              encData = _context.sent;\n              _context.t0 = (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex');\n              _context.t1 = encData;\n              _context.next = 9;\n              return (0, _eccrypto.sign)(channelEncPrivKey, keccak256(encData));\n\n            case 9:\n              _context.t2 = _context.sent.toString('hex');\n              body = {\n                key: _context.t0,\n                data: _context.t1,\n                signature: _context.t2\n              };\n              if (channelState.timeout) body.timeout = channelState.timeout;\n              return _context.abrupt(\"return\", fetch(channelState.serverUrl + '/channel/set', {\n                method: 'POST',\n                body: JSON.stringify(body),\n                headers: {\n                  'Content-Type': 'application/json; charset=utf-8'\n                }\n              }).then(res)[\"catch\"](rej));\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n  });\n}\n\nfunction getSocketInstance(serverUrl) {\n  if (SOCKET_CONN_INSTANCE) {\n    return SOCKET_CONN_INSTANCE;\n  }\n\n  var SOCKET_CONN = (0, _socket.io)(serverUrl, {\n    transports: ['websocket', 'polling'],\n    // use WebSocket first, if available\n    withCredentials: true,\n    reconnectionDelayMax: 10000,\n    reconnectionAttempts: 10\n  });\n  SOCKET_CONN.on('connect_error', function (err) {\n    // revert to classic upgrade\n    SOCKET_CONN.io.opts.transports = ['polling', 'websocket'];\n\n    _util.log.error('connect error', err);\n  });\n  SOCKET_CONN.on('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n    var engine;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            engine = SOCKET_CONN.io.engine;\n\n            _util.log.debug('initially connected to', engine.transport.name); // in most cases, prints \"polling\"\n\n\n            engine.once('upgrade', function () {\n              // called when the transport is upgraded (i.e. from HTTP long-polling to WebSocket)\n              _util.log.debug('upgraded', engine.transport.name); // in most cases, prints \"websocket\"\n\n            });\n            engine.once('close', function (reason) {\n              // called when the underlying connection is closed\n              _util.log.debug('connection closed', reason);\n            });\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })));\n  SOCKET_CONN.on('error', function (err) {\n    _util.log.error('socket errored', err);\n\n    SOCKET_CONN.disconnect();\n  });\n  SOCKET_CONN.on('disconnect', function () {\n    _util.log.debug('socket disconnected');\n  });\n  SOCKET_CONN_INSTANCE = SOCKET_CONN;\n  return SOCKET_CONN;\n}\n\nfunction setupSocketConnection(serverUrl, channelName, fn) {\n  var socketConn = getSocketInstance(serverUrl);\n  var key = storageKey(channelName);\n  var channelEncPrivKey = keccak256(key);\n  var channelPubKey = (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex');\n\n  if (socketConn.connected) {\n    socketConn.emit('check_auth_status', channelPubKey);\n  } else {\n    socketConn.once('connect', function () {\n      _util.log.debug('connected with socket');\n\n      socketConn.emit('check_auth_status', channelPubKey);\n    });\n  }\n\n  var visibilityListener = function visibilityListener() {\n    // if channel is closed, then remove the listener.\n    if (!socketConn) {\n      document.removeEventListener('visibilitychange', visibilityListener);\n      return;\n    } // if not connected, then wait for connection and ping server for latest msg.\n\n\n    if (!socketConn.connected && document.visibilityState === 'visible') {\n      socketConn.once('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                socketConn.emit('check_auth_status', channelPubKey);\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      })));\n    }\n  };\n\n  var listener = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(ev) {\n      var decData;\n      return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return (0, _metadataHelpers.decryptData)(channelEncPrivKey.toString('hex'), ev);\n\n            case 3:\n              decData = _context4.sent;\n\n              _util.log.info(decData);\n\n              fn(decData);\n              _context4.next = 11;\n              break;\n\n            case 8:\n              _context4.prev = 8;\n              _context4.t0 = _context4[\"catch\"](0);\n\n              _util.log.error(_context4.t0);\n\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 8]]);\n    }));\n\n    return function listener(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  socketConn.on(channelPubKey + \"_success\", listener);\n  document.addEventListener('visibilitychange', visibilityListener);\n  return socketConn;\n}\n\nfunction removeStorageEventListener() {\n  if (SOCKET_CONN_INSTANCE) {\n    SOCKET_CONN_INSTANCE.disconnect();\n  }\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n\n  if (!canBeUsed(options)) {\n    throw new Error('BroadcastChannel: server cannot be used');\n  }\n\n  var uuid = (0, _util.randomToken)();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new _obliviousSet.ObliviousSet(options.server.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs,\n    // emittedMessagesIds\n    serverUrl: options.server.url\n  };\n  if (options.server.timeout) state.timeout = options.server.timeout;\n  setupSocketConnection(options.server.url, channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === state.uuid) return; // own message\n\n    if (!msgObj.token || state.eMIs.has(msgObj.token)) return; // already emitted\n    // if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    state.eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\n\nfunction close() {// give 2 sec for all msgs which are in transit to be consumed\n  // by receiver.\n  // window.setTimeout(() => {\n  //     removeStorageEventListener(channelState);\n  //     SOCKET_CONN_INSTANCE = null;\n  // }, 1000);\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  return true;\n}\n\nfunction averageResponseTime() {\n  var defaultTime = 500; // TODO: Maybe increase it based on operation\n\n  return defaultTime;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;","map":{"version":3,"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","averageResponseTime","canBeUsed","close","create","getSocketInstance","keccak256","microSeconds","onMessage","postMessage","removeStorageEventListener","setupSocketConnection","storageKey","type","_regenerator","_asyncToGenerator2","_obliviousSet","_socket","_eccrypto","_metadataHelpers","_keccak","_util","_options","a","update","digest","KEY_PREFIX","SOCKET_CONN_INSTANCE","channelName","channelState","messageJson","Promise","res","rej","sleep","then","mark","_callee","key","channelEncPrivKey","encData","body","wrap","_callee$","_context","prev","next","encryptData","toString","token","randomToken","time","Date","getTime","data","uuid","sent","t0","getPublic","t1","sign","t2","signature","timeout","abrupt","fetch","serverUrl","method","JSON","stringify","headers","stop","SOCKET_CONN","io","transports","withCredentials","reconnectionDelayMax","reconnectionAttempts","on","err","opts","log","error","_callee2","engine","_callee2$","_context2","debug","transport","name","once","reason","disconnect","fn","socketConn","channelPubKey","connected","emit","visibilityListener","document","removeEventListener","visibilityState","_callee3","_callee3$","_context3","listener","_ref4","_callee4","ev","decData","_callee4$","_context4","decryptData","info","_x","apply","arguments","addEventListener","options","fillOptionsWithDefaults","Error","eMIs","ObliviousSet","server","removeTimeout","state","url","msgObj","messagesCallback","has","add","messagesCallbackTime","defaultTime","_default"],"sources":["/home/haluk/react-website-v1/node_modules/@toruslabs/broadcast-channel/dist/lib/methods/server.js"],"sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.averageResponseTime = averageResponseTime;\nexports.canBeUsed = canBeUsed;\nexports.close = close;\nexports.create = create;\nexports[\"default\"] = void 0;\nexports.getSocketInstance = getSocketInstance;\nexports.keccak256 = keccak256;\nexports.microSeconds = void 0;\nexports.onMessage = onMessage;\nexports.postMessage = postMessage;\nexports.removeStorageEventListener = removeStorageEventListener;\nexports.setupSocketConnection = setupSocketConnection;\nexports.storageKey = storageKey;\nexports.type = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _obliviousSet = require(\"oblivious-set\");\n\nvar _socket = require(\"socket.io-client\");\n\nvar _eccrypto = require(\"@toruslabs/eccrypto\");\n\nvar _metadataHelpers = require(\"@toruslabs/metadata-helpers\");\n\nvar _keccak = _interopRequireDefault(require(\"keccak\"));\n\nvar _util = require(\"../util\");\n\nvar _options = require(\"../options\");\n\n/**\n * A localStorage-only method which uses localstorage and its 'storage'-event\n * This does not work inside of webworkers because they have no access to locastorage\n * This is basically implemented to support IE9 or your grandmothers toaster.\n * @link https://caniuse.com/#feat=namevalue-storage\n * @link https://caniuse.com/#feat=indexeddb\n */\nvar microSeconds = _util.microSeconds; // PASS IN STRING/BUFFER TO GET BUFFER\n\nexports.microSeconds = microSeconds;\n\nfunction keccak256(a) {\n  return (0, _keccak[\"default\"])('keccak256').update(a).digest();\n}\n\nvar KEY_PREFIX = 'pubkey.broadcastChannel-';\nvar type = 'server';\nexports.type = type;\nvar SOCKET_CONN_INSTANCE = null;\n\nfunction storageKey(channelName) {\n  return KEY_PREFIX + channelName;\n}\n/**\n * writes the new message to the storage\n * and fires the storage-event so other readers can find it\n */\n\n\nfunction postMessage(channelState, messageJson) {\n  return new Promise(function (res, rej) {\n    (0, _util.sleep)().then( /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee() {\n      var key, channelEncPrivKey, encData, body;\n      return _regenerator[\"default\"].wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              key = storageKey(channelState.channelName);\n              channelEncPrivKey = keccak256(key);\n              _context.next = 4;\n              return (0, _metadataHelpers.encryptData)(channelEncPrivKey.toString('hex'), {\n                token: (0, _util.randomToken)(),\n                time: new Date().getTime(),\n                data: messageJson,\n                uuid: channelState.uuid\n              });\n\n            case 4:\n              encData = _context.sent;\n              _context.t0 = (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex');\n              _context.t1 = encData;\n              _context.next = 9;\n              return (0, _eccrypto.sign)(channelEncPrivKey, keccak256(encData));\n\n            case 9:\n              _context.t2 = _context.sent.toString('hex');\n              body = {\n                key: _context.t0,\n                data: _context.t1,\n                signature: _context.t2\n              };\n              if (channelState.timeout) body.timeout = channelState.timeout;\n              return _context.abrupt(\"return\", fetch(channelState.serverUrl + '/channel/set', {\n                method: 'POST',\n                body: JSON.stringify(body),\n                headers: {\n                  'Content-Type': 'application/json; charset=utf-8'\n                }\n              }).then(res)[\"catch\"](rej));\n\n            case 13:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    })));\n  });\n}\n\nfunction getSocketInstance(serverUrl) {\n  if (SOCKET_CONN_INSTANCE) {\n    return SOCKET_CONN_INSTANCE;\n  }\n\n  var SOCKET_CONN = (0, _socket.io)(serverUrl, {\n    transports: ['websocket', 'polling'],\n    // use WebSocket first, if available\n    withCredentials: true,\n    reconnectionDelayMax: 10000,\n    reconnectionAttempts: 10\n  });\n  SOCKET_CONN.on('connect_error', function (err) {\n    // revert to classic upgrade\n    SOCKET_CONN.io.opts.transports = ['polling', 'websocket'];\n\n    _util.log.error('connect error', err);\n  });\n  SOCKET_CONN.on('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee2() {\n    var engine;\n    return _regenerator[\"default\"].wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            engine = SOCKET_CONN.io.engine;\n\n            _util.log.debug('initially connected to', engine.transport.name); // in most cases, prints \"polling\"\n\n\n            engine.once('upgrade', function () {\n              // called when the transport is upgraded (i.e. from HTTP long-polling to WebSocket)\n              _util.log.debug('upgraded', engine.transport.name); // in most cases, prints \"websocket\"\n\n            });\n            engine.once('close', function (reason) {\n              // called when the underlying connection is closed\n              _util.log.debug('connection closed', reason);\n            });\n\n          case 4:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  })));\n  SOCKET_CONN.on('error', function (err) {\n    _util.log.error('socket errored', err);\n\n    SOCKET_CONN.disconnect();\n  });\n  SOCKET_CONN.on('disconnect', function () {\n    _util.log.debug('socket disconnected');\n  });\n  SOCKET_CONN_INSTANCE = SOCKET_CONN;\n  return SOCKET_CONN;\n}\n\nfunction setupSocketConnection(serverUrl, channelName, fn) {\n  var socketConn = getSocketInstance(serverUrl);\n  var key = storageKey(channelName);\n  var channelEncPrivKey = keccak256(key);\n  var channelPubKey = (0, _eccrypto.getPublic)(channelEncPrivKey).toString('hex');\n\n  if (socketConn.connected) {\n    socketConn.emit('check_auth_status', channelPubKey);\n  } else {\n    socketConn.once('connect', function () {\n      _util.log.debug('connected with socket');\n\n      socketConn.emit('check_auth_status', channelPubKey);\n    });\n  }\n\n  var visibilityListener = function visibilityListener() {\n    // if channel is closed, then remove the listener.\n    if (!socketConn) {\n      document.removeEventListener('visibilitychange', visibilityListener);\n      return;\n    } // if not connected, then wait for connection and ping server for latest msg.\n\n\n    if (!socketConn.connected && document.visibilityState === 'visible') {\n      socketConn.once('connect', /*#__PURE__*/(0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee3() {\n        return _regenerator[\"default\"].wrap(function _callee3$(_context3) {\n          while (1) {\n            switch (_context3.prev = _context3.next) {\n              case 0:\n                socketConn.emit('check_auth_status', channelPubKey);\n\n              case 1:\n              case \"end\":\n                return _context3.stop();\n            }\n          }\n        }, _callee3);\n      })));\n    }\n  };\n\n  var listener = /*#__PURE__*/function () {\n    var _ref4 = (0, _asyncToGenerator2[\"default\"])( /*#__PURE__*/_regenerator[\"default\"].mark(function _callee4(ev) {\n      var decData;\n      return _regenerator[\"default\"].wrap(function _callee4$(_context4) {\n        while (1) {\n          switch (_context4.prev = _context4.next) {\n            case 0:\n              _context4.prev = 0;\n              _context4.next = 3;\n              return (0, _metadataHelpers.decryptData)(channelEncPrivKey.toString('hex'), ev);\n\n            case 3:\n              decData = _context4.sent;\n\n              _util.log.info(decData);\n\n              fn(decData);\n              _context4.next = 11;\n              break;\n\n            case 8:\n              _context4.prev = 8;\n              _context4.t0 = _context4[\"catch\"](0);\n\n              _util.log.error(_context4.t0);\n\n            case 11:\n            case \"end\":\n              return _context4.stop();\n          }\n        }\n      }, _callee4, null, [[0, 8]]);\n    }));\n\n    return function listener(_x) {\n      return _ref4.apply(this, arguments);\n    };\n  }();\n\n  socketConn.on(channelPubKey + \"_success\", listener);\n  document.addEventListener('visibilitychange', visibilityListener);\n  return socketConn;\n}\n\nfunction removeStorageEventListener() {\n  if (SOCKET_CONN_INSTANCE) {\n    SOCKET_CONN_INSTANCE.disconnect();\n  }\n}\n\nfunction create(channelName, options) {\n  options = (0, _options.fillOptionsWithDefaults)(options);\n\n  if (!canBeUsed(options)) {\n    throw new Error('BroadcastChannel: server cannot be used');\n  }\n\n  var uuid = (0, _util.randomToken)();\n  /**\n   * eMIs\n   * contains all messages that have been emitted before\n   * @type {ObliviousSet}\n   */\n\n  var eMIs = new _obliviousSet.ObliviousSet(options.server.removeTimeout);\n  var state = {\n    channelName: channelName,\n    uuid: uuid,\n    eMIs: eMIs,\n    // emittedMessagesIds\n    serverUrl: options.server.url\n  };\n  if (options.server.timeout) state.timeout = options.server.timeout;\n  setupSocketConnection(options.server.url, channelName, function (msgObj) {\n    if (!state.messagesCallback) return; // no listener\n\n    if (msgObj.uuid === state.uuid) return; // own message\n\n    if (!msgObj.token || state.eMIs.has(msgObj.token)) return; // already emitted\n    // if (msgObj.data.time && msgObj.data.time < state.messagesCallbackTime) return; // too old\n\n    state.eMIs.add(msgObj.token);\n    state.messagesCallback(msgObj.data);\n  });\n  return state;\n}\n\nfunction close() {// give 2 sec for all msgs which are in transit to be consumed\n  // by receiver.\n  // window.setTimeout(() => {\n  //     removeStorageEventListener(channelState);\n  //     SOCKET_CONN_INSTANCE = null;\n  // }, 1000);\n}\n\nfunction onMessage(channelState, fn, time) {\n  channelState.messagesCallbackTime = time;\n  channelState.messagesCallback = fn;\n}\n\nfunction canBeUsed() {\n  return true;\n}\n\nfunction averageResponseTime() {\n  var defaultTime = 500; // TODO: Maybe increase it based on operation\n\n  return defaultTime;\n}\n\nvar _default = {\n  create: create,\n  close: close,\n  onMessage: onMessage,\n  postMessage: postMessage,\n  canBeUsed: canBeUsed,\n  type: type,\n  averageResponseTime: averageResponseTime,\n  microSeconds: microSeconds\n};\nexports[\"default\"] = _default;"],"mappings":"AAAA;;AAEA,IAAIA,sBAAsB,GAAGC,OAAO,CAAC,8CAAD,CAApC;;AAEAC,MAAM,CAACC,cAAP,CAAsBC,OAAtB,EAA+B,YAA/B,EAA6C;EAC3CC,KAAK,EAAE;AADoC,CAA7C;AAGAD,OAAO,CAACE,mBAAR,GAA8BA,mBAA9B;AACAF,OAAO,CAACG,SAAR,GAAoBA,SAApB;AACAH,OAAO,CAACI,KAAR,GAAgBA,KAAhB;AACAJ,OAAO,CAACK,MAAR,GAAiBA,MAAjB;AACAL,OAAO,CAAC,SAAD,CAAP,GAAqB,KAAK,CAA1B;AACAA,OAAO,CAACM,iBAAR,GAA4BA,iBAA5B;AACAN,OAAO,CAACO,SAAR,GAAoBA,SAApB;AACAP,OAAO,CAACQ,YAAR,GAAuB,KAAK,CAA5B;AACAR,OAAO,CAACS,SAAR,GAAoBA,SAApB;AACAT,OAAO,CAACU,WAAR,GAAsBA,WAAtB;AACAV,OAAO,CAACW,0BAAR,GAAqCA,0BAArC;AACAX,OAAO,CAACY,qBAAR,GAAgCA,qBAAhC;AACAZ,OAAO,CAACa,UAAR,GAAqBA,UAArB;AACAb,OAAO,CAACc,IAAR,GAAe,KAAK,CAApB;;AAEA,IAAIC,YAAY,GAAGnB,sBAAsB,CAACC,OAAO,CAAC,4BAAD,CAAR,CAAzC;;AAEA,IAAImB,kBAAkB,GAAGpB,sBAAsB,CAACC,OAAO,CAAC,yCAAD,CAAR,CAA/C;;AAEA,IAAIoB,aAAa,GAAGpB,OAAO,CAAC,eAAD,CAA3B;;AAEA,IAAIqB,OAAO,GAAGrB,OAAO,CAAC,kBAAD,CAArB;;AAEA,IAAIsB,SAAS,GAAGtB,OAAO,CAAC,qBAAD,CAAvB;;AAEA,IAAIuB,gBAAgB,GAAGvB,OAAO,CAAC,6BAAD,CAA9B;;AAEA,IAAIwB,OAAO,GAAGzB,sBAAsB,CAACC,OAAO,CAAC,QAAD,CAAR,CAApC;;AAEA,IAAIyB,KAAK,GAAGzB,OAAO,CAAC,SAAD,CAAnB;;AAEA,IAAI0B,QAAQ,GAAG1B,OAAO,CAAC,YAAD,CAAtB;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;;AACA,IAAIW,YAAY,GAAGc,KAAK,CAACd,YAAzB,C,CAAuC;;AAEvCR,OAAO,CAACQ,YAAR,GAAuBA,YAAvB;;AAEA,SAASD,SAAT,CAAmBiB,CAAnB,EAAsB;EACpB,OAAO,CAAC,GAAGH,OAAO,CAAC,SAAD,CAAX,EAAwB,WAAxB,EAAqCI,MAArC,CAA4CD,CAA5C,EAA+CE,MAA/C,EAAP;AACD;;AAED,IAAIC,UAAU,GAAG,0BAAjB;AACA,IAAIb,IAAI,GAAG,QAAX;AACAd,OAAO,CAACc,IAAR,GAAeA,IAAf;AACA,IAAIc,oBAAoB,GAAG,IAA3B;;AAEA,SAASf,UAAT,CAAoBgB,WAApB,EAAiC;EAC/B,OAAOF,UAAU,GAAGE,WAApB;AACD;AACD;AACA;AACA;AACA;;;AAGA,SAASnB,WAAT,CAAqBoB,YAArB,EAAmCC,WAAnC,EAAgD;EAC9C,OAAO,IAAIC,OAAJ,CAAY,UAAUC,GAAV,EAAeC,GAAf,EAAoB;IACrC,CAAC,GAAGZ,KAAK,CAACa,KAAV,IAAmBC,IAAnB,EAAyB,aAAa,CAAC,GAAGpB,kBAAkB,CAAC,SAAD,CAAtB,GAAoC,aAAaD,YAAY,CAAC,SAAD,CAAZ,CAAwBsB,IAAxB,CAA6B,SAASC,OAAT,GAAmB;MACrI,IAAIC,GAAJ,EAASC,iBAAT,EAA4BC,OAA5B,EAAqCC,IAArC;MACA,OAAO3B,YAAY,CAAC,SAAD,CAAZ,CAAwB4B,IAAxB,CAA6B,SAASC,QAAT,CAAkBC,QAAlB,EAA4B;QAC9D,OAAO,CAAP,EAAU;UACR,QAAQA,QAAQ,CAACC,IAAT,GAAgBD,QAAQ,CAACE,IAAjC;YACE,KAAK,CAAL;cACER,GAAG,GAAG1B,UAAU,CAACiB,YAAY,CAACD,WAAd,CAAhB;cACAW,iBAAiB,GAAGjC,SAAS,CAACgC,GAAD,CAA7B;cACAM,QAAQ,CAACE,IAAT,GAAgB,CAAhB;cACA,OAAO,CAAC,GAAG3B,gBAAgB,CAAC4B,WAArB,EAAkCR,iBAAiB,CAACS,QAAlB,CAA2B,KAA3B,CAAlC,EAAqE;gBAC1EC,KAAK,EAAE,CAAC,GAAG5B,KAAK,CAAC6B,WAAV,GADmE;gBAE1EC,IAAI,EAAE,IAAIC,IAAJ,GAAWC,OAAX,EAFoE;gBAG1EC,IAAI,EAAExB,WAHoE;gBAI1EyB,IAAI,EAAE1B,YAAY,CAAC0B;cAJuD,CAArE,CAAP;;YAOF,KAAK,CAAL;cACEf,OAAO,GAAGI,QAAQ,CAACY,IAAnB;cACAZ,QAAQ,CAACa,EAAT,GAAc,CAAC,GAAGvC,SAAS,CAACwC,SAAd,EAAyBnB,iBAAzB,EAA4CS,QAA5C,CAAqD,KAArD,CAAd;cACAJ,QAAQ,CAACe,EAAT,GAAcnB,OAAd;cACAI,QAAQ,CAACE,IAAT,GAAgB,CAAhB;cACA,OAAO,CAAC,GAAG5B,SAAS,CAAC0C,IAAd,EAAoBrB,iBAApB,EAAuCjC,SAAS,CAACkC,OAAD,CAAhD,CAAP;;YAEF,KAAK,CAAL;cACEI,QAAQ,CAACiB,EAAT,GAAcjB,QAAQ,CAACY,IAAT,CAAcR,QAAd,CAAuB,KAAvB,CAAd;cACAP,IAAI,GAAG;gBACLH,GAAG,EAAEM,QAAQ,CAACa,EADT;gBAELH,IAAI,EAAEV,QAAQ,CAACe,EAFV;gBAGLG,SAAS,EAAElB,QAAQ,CAACiB;cAHf,CAAP;cAKA,IAAIhC,YAAY,CAACkC,OAAjB,EAA0BtB,IAAI,CAACsB,OAAL,GAAelC,YAAY,CAACkC,OAA5B;cAC1B,OAAOnB,QAAQ,CAACoB,MAAT,CAAgB,QAAhB,EAA0BC,KAAK,CAACpC,YAAY,CAACqC,SAAb,GAAyB,cAA1B,EAA0C;gBAC9EC,MAAM,EAAE,MADsE;gBAE9E1B,IAAI,EAAE2B,IAAI,CAACC,SAAL,CAAe5B,IAAf,CAFwE;gBAG9E6B,OAAO,EAAE;kBACP,gBAAgB;gBADT;cAHqE,CAA1C,CAAL,CAM9BnC,IAN8B,CAMzBH,GANyB,EAMpB,OANoB,EAMXC,GANW,CAA1B,CAAP;;YAQF,KAAK,EAAL;YACA,KAAK,KAAL;cACE,OAAOW,QAAQ,CAAC2B,IAAT,EAAP;UArCJ;QAuCD;MACF,CA1CM,EA0CJlC,OA1CI,CAAP;IA2CD,CA7CsF,CAAjD,CAAtC;EA8CD,CA/CM,CAAP;AAgDD;;AAED,SAAShC,iBAAT,CAA2B6D,SAA3B,EAAsC;EACpC,IAAIvC,oBAAJ,EAA0B;IACxB,OAAOA,oBAAP;EACD;;EAED,IAAI6C,WAAW,GAAG,CAAC,GAAGvD,OAAO,CAACwD,EAAZ,EAAgBP,SAAhB,EAA2B;IAC3CQ,UAAU,EAAE,CAAC,WAAD,EAAc,SAAd,CAD+B;IAE3C;IACAC,eAAe,EAAE,IAH0B;IAI3CC,oBAAoB,EAAE,KAJqB;IAK3CC,oBAAoB,EAAE;EALqB,CAA3B,CAAlB;EAOAL,WAAW,CAACM,EAAZ,CAAe,eAAf,EAAgC,UAAUC,GAAV,EAAe;IAC7C;IACAP,WAAW,CAACC,EAAZ,CAAeO,IAAf,CAAoBN,UAApB,GAAiC,CAAC,SAAD,EAAY,WAAZ,CAAjC;;IAEArD,KAAK,CAAC4D,GAAN,CAAUC,KAAV,CAAgB,eAAhB,EAAiCH,GAAjC;EACD,CALD;EAMAP,WAAW,CAACM,EAAZ,CAAe,SAAf,EAA0B,aAAa,CAAC,GAAG/D,kBAAkB,CAAC,SAAD,CAAtB,GAAoC,aAAaD,YAAY,CAAC,SAAD,CAAZ,CAAwBsB,IAAxB,CAA6B,SAAS+C,QAAT,GAAoB;IACvI,IAAIC,MAAJ;IACA,OAAOtE,YAAY,CAAC,SAAD,CAAZ,CAAwB4B,IAAxB,CAA6B,SAAS2C,SAAT,CAAmBC,SAAnB,EAA8B;MAChE,OAAO,CAAP,EAAU;QACR,QAAQA,SAAS,CAACzC,IAAV,GAAiByC,SAAS,CAACxC,IAAnC;UACE,KAAK,CAAL;YACEsC,MAAM,GAAGZ,WAAW,CAACC,EAAZ,CAAeW,MAAxB;;YAEA/D,KAAK,CAAC4D,GAAN,CAAUM,KAAV,CAAgB,wBAAhB,EAA0CH,MAAM,CAACI,SAAP,CAAiBC,IAA3D,EAHF,CAGoE;;;YAGlEL,MAAM,CAACM,IAAP,CAAY,SAAZ,EAAuB,YAAY;cACjC;cACArE,KAAK,CAAC4D,GAAN,CAAUM,KAAV,CAAgB,UAAhB,EAA4BH,MAAM,CAACI,SAAP,CAAiBC,IAA7C,EAFiC,CAEmB;;YAErD,CAJD;YAKAL,MAAM,CAACM,IAAP,CAAY,OAAZ,EAAqB,UAAUC,MAAV,EAAkB;cACrC;cACAtE,KAAK,CAAC4D,GAAN,CAAUM,KAAV,CAAgB,mBAAhB,EAAqCI,MAArC;YACD,CAHD;;UAKF,KAAK,CAAL;UACA,KAAK,KAAL;YACE,OAAOL,SAAS,CAACf,IAAV,EAAP;QAnBJ;MAqBD;IACF,CAxBM,EAwBJY,QAxBI,CAAP;EAyBD,CA3BuF,CAAjD,CAAvC;EA4BAX,WAAW,CAACM,EAAZ,CAAe,OAAf,EAAwB,UAAUC,GAAV,EAAe;IACrC1D,KAAK,CAAC4D,GAAN,CAAUC,KAAV,CAAgB,gBAAhB,EAAkCH,GAAlC;;IAEAP,WAAW,CAACoB,UAAZ;EACD,CAJD;EAKApB,WAAW,CAACM,EAAZ,CAAe,YAAf,EAA6B,YAAY;IACvCzD,KAAK,CAAC4D,GAAN,CAAUM,KAAV,CAAgB,qBAAhB;EACD,CAFD;EAGA5D,oBAAoB,GAAG6C,WAAvB;EACA,OAAOA,WAAP;AACD;;AAED,SAAS7D,qBAAT,CAA+BuD,SAA/B,EAA0CtC,WAA1C,EAAuDiE,EAAvD,EAA2D;EACzD,IAAIC,UAAU,GAAGzF,iBAAiB,CAAC6D,SAAD,CAAlC;EACA,IAAI5B,GAAG,GAAG1B,UAAU,CAACgB,WAAD,CAApB;EACA,IAAIW,iBAAiB,GAAGjC,SAAS,CAACgC,GAAD,CAAjC;EACA,IAAIyD,aAAa,GAAG,CAAC,GAAG7E,SAAS,CAACwC,SAAd,EAAyBnB,iBAAzB,EAA4CS,QAA5C,CAAqD,KAArD,CAApB;;EAEA,IAAI8C,UAAU,CAACE,SAAf,EAA0B;IACxBF,UAAU,CAACG,IAAX,CAAgB,mBAAhB,EAAqCF,aAArC;EACD,CAFD,MAEO;IACLD,UAAU,CAACJ,IAAX,CAAgB,SAAhB,EAA2B,YAAY;MACrCrE,KAAK,CAAC4D,GAAN,CAAUM,KAAV,CAAgB,uBAAhB;;MAEAO,UAAU,CAACG,IAAX,CAAgB,mBAAhB,EAAqCF,aAArC;IACD,CAJD;EAKD;;EAED,IAAIG,kBAAkB,GAAG,SAASA,kBAAT,GAA8B;IACrD;IACA,IAAI,CAACJ,UAAL,EAAiB;MACfK,QAAQ,CAACC,mBAAT,CAA6B,kBAA7B,EAAiDF,kBAAjD;MACA;IACD,CALoD,CAKnD;;;IAGF,IAAI,CAACJ,UAAU,CAACE,SAAZ,IAAyBG,QAAQ,CAACE,eAAT,KAA6B,SAA1D,EAAqE;MACnEP,UAAU,CAACJ,IAAX,CAAgB,SAAhB,EAA2B,aAAa,CAAC,GAAG3E,kBAAkB,CAAC,SAAD,CAAtB,GAAoC,aAAaD,YAAY,CAAC,SAAD,CAAZ,CAAwBsB,IAAxB,CAA6B,SAASkE,QAAT,GAAoB;QACxI,OAAOxF,YAAY,CAAC,SAAD,CAAZ,CAAwB4B,IAAxB,CAA6B,SAAS6D,SAAT,CAAmBC,SAAnB,EAA8B;UAChE,OAAO,CAAP,EAAU;YACR,QAAQA,SAAS,CAAC3D,IAAV,GAAiB2D,SAAS,CAAC1D,IAAnC;cACE,KAAK,CAAL;gBACEgD,UAAU,CAACG,IAAX,CAAgB,mBAAhB,EAAqCF,aAArC;;cAEF,KAAK,CAAL;cACA,KAAK,KAAL;gBACE,OAAOS,SAAS,CAACjC,IAAV,EAAP;YANJ;UAQD;QACF,CAXM,EAWJ+B,QAXI,CAAP;MAYD,CAbwF,CAAjD,CAAxC;IAcD;EACF,CAxBD;;EA0BA,IAAIG,QAAQ,GAAG,aAAa,YAAY;IACtC,IAAIC,KAAK,GAAG,CAAC,GAAG3F,kBAAkB,CAAC,SAAD,CAAtB,GAAoC,aAAaD,YAAY,CAAC,SAAD,CAAZ,CAAwBsB,IAAxB,CAA6B,SAASuE,QAAT,CAAkBC,EAAlB,EAAsB;MAC9G,IAAIC,OAAJ;MACA,OAAO/F,YAAY,CAAC,SAAD,CAAZ,CAAwB4B,IAAxB,CAA6B,SAASoE,SAAT,CAAmBC,SAAnB,EAA8B;QAChE,OAAO,CAAP,EAAU;UACR,QAAQA,SAAS,CAAClE,IAAV,GAAiBkE,SAAS,CAACjE,IAAnC;YACE,KAAK,CAAL;cACEiE,SAAS,CAAClE,IAAV,GAAiB,CAAjB;cACAkE,SAAS,CAACjE,IAAV,GAAiB,CAAjB;cACA,OAAO,CAAC,GAAG3B,gBAAgB,CAAC6F,WAArB,EAAkCzE,iBAAiB,CAACS,QAAlB,CAA2B,KAA3B,CAAlC,EAAqE4D,EAArE,CAAP;;YAEF,KAAK,CAAL;cACEC,OAAO,GAAGE,SAAS,CAACvD,IAApB;;cAEAnC,KAAK,CAAC4D,GAAN,CAAUgC,IAAV,CAAeJ,OAAf;;cAEAhB,EAAE,CAACgB,OAAD,CAAF;cACAE,SAAS,CAACjE,IAAV,GAAiB,EAAjB;cACA;;YAEF,KAAK,CAAL;cACEiE,SAAS,CAAClE,IAAV,GAAiB,CAAjB;cACAkE,SAAS,CAACtD,EAAV,GAAesD,SAAS,CAAC,OAAD,CAAT,CAAmB,CAAnB,CAAf;;cAEA1F,KAAK,CAAC4D,GAAN,CAAUC,KAAV,CAAgB6B,SAAS,CAACtD,EAA1B;;YAEF,KAAK,EAAL;YACA,KAAK,KAAL;cACE,OAAOsD,SAAS,CAACxC,IAAV,EAAP;UAvBJ;QAyBD;MACF,CA5BM,EA4BJoC,QA5BI,EA4BM,IA5BN,EA4BY,CAAC,CAAC,CAAD,EAAI,CAAJ,CAAD,CA5BZ,CAAP;IA6BD,CA/B4D,CAAjD,CAAZ;;IAiCA,OAAO,SAASF,QAAT,CAAkBS,EAAlB,EAAsB;MAC3B,OAAOR,KAAK,CAACS,KAAN,CAAY,IAAZ,EAAkBC,SAAlB,CAAP;IACD,CAFD;EAGD,CArC2B,EAA5B;;EAuCAtB,UAAU,CAAChB,EAAX,CAAciB,aAAa,GAAG,UAA9B,EAA0CU,QAA1C;EACAN,QAAQ,CAACkB,gBAAT,CAA0B,kBAA1B,EAA8CnB,kBAA9C;EACA,OAAOJ,UAAP;AACD;;AAED,SAASpF,0BAAT,GAAsC;EACpC,IAAIiB,oBAAJ,EAA0B;IACxBA,oBAAoB,CAACiE,UAArB;EACD;AACF;;AAED,SAASxF,MAAT,CAAgBwB,WAAhB,EAA6B0F,OAA7B,EAAsC;EACpCA,OAAO,GAAG,CAAC,GAAGhG,QAAQ,CAACiG,uBAAb,EAAsCD,OAAtC,CAAV;;EAEA,IAAI,CAACpH,SAAS,CAACoH,OAAD,CAAd,EAAyB;IACvB,MAAM,IAAIE,KAAJ,CAAU,yCAAV,CAAN;EACD;;EAED,IAAIjE,IAAI,GAAG,CAAC,GAAGlC,KAAK,CAAC6B,WAAV,GAAX;EACA;AACF;AACA;AACA;AACA;;EAEE,IAAIuE,IAAI,GAAG,IAAIzG,aAAa,CAAC0G,YAAlB,CAA+BJ,OAAO,CAACK,MAAR,CAAeC,aAA9C,CAAX;EACA,IAAIC,KAAK,GAAG;IACVjG,WAAW,EAAEA,WADH;IAEV2B,IAAI,EAAEA,IAFI;IAGVkE,IAAI,EAAEA,IAHI;IAIV;IACAvD,SAAS,EAAEoD,OAAO,CAACK,MAAR,CAAeG;EALhB,CAAZ;EAOA,IAAIR,OAAO,CAACK,MAAR,CAAe5D,OAAnB,EAA4B8D,KAAK,CAAC9D,OAAN,GAAgBuD,OAAO,CAACK,MAAR,CAAe5D,OAA/B;EAC5BpD,qBAAqB,CAAC2G,OAAO,CAACK,MAAR,CAAeG,GAAhB,EAAqBlG,WAArB,EAAkC,UAAUmG,MAAV,EAAkB;IACvE,IAAI,CAACF,KAAK,CAACG,gBAAX,EAA6B,OAD0C,CAClC;;IAErC,IAAID,MAAM,CAACxE,IAAP,KAAgBsE,KAAK,CAACtE,IAA1B,EAAgC,OAHuC,CAG/B;;IAExC,IAAI,CAACwE,MAAM,CAAC9E,KAAR,IAAiB4E,KAAK,CAACJ,IAAN,CAAWQ,GAAX,CAAeF,MAAM,CAAC9E,KAAtB,CAArB,EAAmD,OALoB,CAKZ;IAC3D;;IAEA4E,KAAK,CAACJ,IAAN,CAAWS,GAAX,CAAeH,MAAM,CAAC9E,KAAtB;IACA4E,KAAK,CAACG,gBAAN,CAAuBD,MAAM,CAACzE,IAA9B;EACD,CAVoB,CAArB;EAWA,OAAOuE,KAAP;AACD;;AAED,SAAS1H,KAAT,GAAiB,CAAC;EAChB;EACA;EACA;EACA;EACA;AACD;;AAED,SAASK,SAAT,CAAmBqB,YAAnB,EAAiCgE,EAAjC,EAAqC1C,IAArC,EAA2C;EACzCtB,YAAY,CAACsG,oBAAb,GAAoChF,IAApC;EACAtB,YAAY,CAACmG,gBAAb,GAAgCnC,EAAhC;AACD;;AAED,SAAS3F,SAAT,GAAqB;EACnB,OAAO,IAAP;AACD;;AAED,SAASD,mBAAT,GAA+B;EAC7B,IAAImI,WAAW,GAAG,GAAlB,CAD6B,CACN;;EAEvB,OAAOA,WAAP;AACD;;AAED,IAAIC,QAAQ,GAAG;EACbjI,MAAM,EAAEA,MADK;EAEbD,KAAK,EAAEA,KAFM;EAGbK,SAAS,EAAEA,SAHE;EAIbC,WAAW,EAAEA,WAJA;EAKbP,SAAS,EAAEA,SALE;EAMbW,IAAI,EAAEA,IANO;EAObZ,mBAAmB,EAAEA,mBAPR;EAQbM,YAAY,EAAEA;AARD,CAAf;AAUAR,OAAO,CAAC,SAAD,CAAP,GAAqBsI,QAArB"},"metadata":{},"sourceType":"script"}