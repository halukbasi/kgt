{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SlopeWalletAdapter = exports.SlopeWalletName = void 0;\n\nconst wallet_adapter_base_1 = require(\"@solana/wallet-adapter-base\");\n\nconst web3_js_1 = require(\"@solana/web3.js\");\n\nconst bs58_1 = __importDefault(require(\"bs58\"));\n\nexports.SlopeWalletName = 'Slope';\n\nclass SlopeWalletAdapter extends wallet_adapter_base_1.BaseMessageSignerWalletAdapter {\n  constructor() {\n    let config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n    super();\n    this.name = exports.SlopeWalletName;\n    this.url = 'https://slope.finance';\n    this.icon = 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTI4IiBoZWlnaHQ9IjEyOCIgdmlld0JveD0iMCAwIDEyOCAxMjgiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjgiIGhlaWdodD0iMTI4IiByeD0iNjQiIGZpbGw9IiM2RTY2RkEiLz4KPHBhdGggZD0iTTI3Ljk0NzUgNTIuMTU5Nkw1MS45ODI2IDI4LjA1NzJMNzIuNjA5OCA3LjY1Mzg5QzczLjg3MzQgNi40MDQwMSA3Ni4wMTc4IDcuMjk5MSA3Ni4wMTc4IDkuMDc2NDJMNzYuMDE4NyA1Mi4xNTlMNTEuOTgzNiA3Ni4xMjY4TDI3Ljk0NzUgNTIuMTU5NloiIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl8zNzk1XzI1NTQzKSIvPgo8cGF0aCBkPSJNMTAwLjA1MyA3NS45OTNMNzYuMDE4IDUxLjk1OEw1MS45ODI5IDc1Ljk5MzFMNTEuOTgyOSAxMTguOTI0QzUxLjk4MjkgMTIwLjcwMyA1NC4xMzEyIDEyMS41OTcgNTUuMzkzNyAxMjAuMzQzTDEwMC4wNTMgNzUuOTkzWiIgZmlsbD0idXJsKCNwYWludDFfbGluZWFyXzM3OTVfMjU1NDMpIi8+CjxwYXRoIGQ9Ik0yNy45NDcgNTIuMTYwMUg0NC42ODM5QzQ4LjcxNDcgNTIuMTYwMSA1MS45ODIyIDU1LjQyNzYgNTEuOTgyMiA1OS40NTgzVjc2LjEyNjlIMzUuMjQ1M0MzMS4yMTQ2IDc2LjEyNjkgMjcuOTQ3IDcyLjg1OTQgMjcuOTQ3IDY4LjgyODdWNTIuMTYwMVoiIGZpbGw9IiNGMUYwRkYiLz4KPHBhdGggZD0iTTc2LjAxNzggNTIuMTYwMUg5Mi43NTQ3Qzk2Ljc4NTUgNTIuMTYwMSAxMDAuMDUzIDU1LjQyNzYgMTAwLjA1MyA1OS40NTgzVjc2LjEyNjlIODMuMzE2MUM3OS4yODU0IDc2LjEyNjkgNzYuMDE3OCA3Mi44NTk0IDc2LjAxNzggNjguODI4N1Y1Mi4xNjAxWiIgZmlsbD0iI0YxRjBGRiIvPgo8ZGVmcz4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDBfbGluZWFyXzM3OTVfMjU1NDMiIHgxPSI1MS45ODMxIiB5MT0iNy4wNzE1NSIgeDI9IjUxLjk4MzEiIHkyPSI3Ni4xMjY4IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIHN0b3AtY29sb3I9IiNBOEFERkYiLz4KPHN0b3Agb2Zmc2V0PSIwLjY0ODU1NiIgc3RvcC1jb2xvcj0id2hpdGUiLz4KPC9saW5lYXJHcmFkaWVudD4KPGxpbmVhckdyYWRpZW50IGlkPSJwYWludDFfbGluZWFyXzM3OTVfMjU1NDMiIHgxPSI3Ni4wMTgiIHkxPSI1MS45NTgiIHgyPSI3Ni4wMTgiIHkyPSIxMjAuOTI4IiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSI+CjxzdG9wIG9mZnNldD0iMC4yNjA3ODQiIHN0b3AtY29sb3I9IiNCNkJBRkYiLz4KPHN0b3Agb2Zmc2V0PSIxIiBzdG9wLWNvbG9yPSIjRTRFMkZGIi8+CjwvbGluZWFyR3JhZGllbnQ+CjwvZGVmcz4KPC9zdmc+Cg==';\n    this._readyState = typeof window === 'undefined' || typeof document === 'undefined' ? wallet_adapter_base_1.WalletReadyState.Unsupported : wallet_adapter_base_1.WalletReadyState.NotDetected;\n    this._connecting = false;\n    this._wallet = null;\n    this._publicKey = null;\n\n    if (this._readyState !== wallet_adapter_base_1.WalletReadyState.Unsupported) {\n      (0, wallet_adapter_base_1.scopePollingDetectionStrategy)(() => {\n        if (typeof window.Slope === 'function' || window.slopeApp) {\n          this._readyState = wallet_adapter_base_1.WalletReadyState.Installed;\n          this.emit('readyStateChange', this._readyState);\n          return true;\n        }\n\n        return false;\n      });\n    }\n  }\n\n  get publicKey() {\n    return this._publicKey;\n  }\n\n  get connecting() {\n    return this._connecting;\n  }\n\n  get readyState() {\n    return this._readyState;\n  }\n\n  connect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        if (this.connected || this.connecting) return;\n        if (this._readyState !== wallet_adapter_base_1.WalletReadyState.Installed || typeof window.Slope !== 'function') throw new wallet_adapter_base_1.WalletNotReadyError();\n        this._connecting = true;\n        const wallet = new window.Slope();\n        let data;\n\n        try {\n          ({\n            data\n          } = yield wallet.connect());\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletConnectionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        if (!data.publicKey) throw new wallet_adapter_base_1.WalletAccountError();\n        let publicKey;\n\n        try {\n          publicKey = new web3_js_1.PublicKey(data.publicKey);\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletPublicKeyError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n\n        this._wallet = wallet;\n        this._publicKey = publicKey;\n        this.emit('connect', publicKey);\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      } finally {\n        this._connecting = false;\n      }\n    });\n  }\n\n  disconnect() {\n    return __awaiter(this, void 0, void 0, function* () {\n      const wallet = this._wallet;\n\n      if (wallet) {\n        this._wallet = null;\n        this._publicKey = null;\n\n        try {\n          let msg;\n\n          try {\n            ({\n              msg\n            } = yield wallet.disconnect());\n          } catch (error) {\n            throw new wallet_adapter_base_1.WalletDisconnectionError(error === null || error === void 0 ? void 0 : error.message, error);\n          }\n\n          if (msg !== 'ok') throw new wallet_adapter_base_1.WalletDisconnectionError(msg);\n        } catch (error) {\n          this.emit('error', error);\n        }\n      }\n\n      this.emit('disconnect');\n    });\n  }\n\n  signTransaction(transaction) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new wallet_adapter_base_1.WalletNotConnectedError();\n\n        try {\n          const message = bs58_1.default.encode(transaction.serializeMessage());\n          const {\n            msg,\n            data\n          } = yield wallet.signTransaction(message);\n          if (!data.publicKey || !data.signature) throw new wallet_adapter_base_1.WalletSignTransactionError(msg);\n          const publicKey = new web3_js_1.PublicKey(data.publicKey);\n          const signature = bs58_1.default.decode(data.signature);\n          transaction.addSignature(publicKey, signature);\n          return transaction;\n        } catch (error) {\n          if (error instanceof wallet_adapter_base_1.WalletError) throw error;\n          throw new wallet_adapter_base_1.WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n  signAllTransactions(transactions) {\n    var _a;\n\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new wallet_adapter_base_1.WalletNotConnectedError();\n\n        try {\n          const messages = transactions.map(transaction => bs58_1.default.encode(transaction.serializeMessage()));\n          const {\n            msg,\n            data\n          } = yield wallet.signAllTransactions(messages);\n          const length = transactions.length;\n          if (!data.publicKey || ((_a = data.signatures) === null || _a === void 0 ? void 0 : _a.length) !== length) throw new wallet_adapter_base_1.WalletSignTransactionError(msg);\n          const publicKey = new web3_js_1.PublicKey(data.publicKey);\n\n          for (let i = 0; i < length; i++) {\n            transactions[i].addSignature(publicKey, bs58_1.default.decode(data.signatures[i]));\n          }\n\n          return transactions;\n        } catch (error) {\n          if (error instanceof wallet_adapter_base_1.WalletError) throw error;\n          throw new wallet_adapter_base_1.WalletSignTransactionError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n  signMessage(message) {\n    return __awaiter(this, void 0, void 0, function* () {\n      try {\n        const wallet = this._wallet;\n        if (!wallet) throw new wallet_adapter_base_1.WalletNotConnectedError();\n\n        try {\n          const response = yield wallet.signMessage(message);\n          return bs58_1.default.decode(response.data.signature);\n        } catch (error) {\n          throw new wallet_adapter_base_1.WalletSignMessageError(error === null || error === void 0 ? void 0 : error.message, error);\n        }\n      } catch (error) {\n        this.emit('error', error);\n        throw error;\n      }\n    });\n  }\n\n}\n\nexports.SlopeWalletAdapter = SlopeWalletAdapter;","map":{"version":3,"mappings":"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","names":["exports","SlopeWalletAdapter","wallet_adapter_base_1","constructor","config","window","document","Unsupported","NotDetected","_connecting","_wallet","_publicKey","_readyState","Slope","slopeApp","Installed","emit","publicKey","connecting","readyState","connect","connected","wallet","data","error","message","web3_js_1","disconnect","msg","signTransaction","transaction","bs58_1","encode","serializeMessage","signature","decode","addSignature","signAllTransactions","transactions","messages","map","length","signatures","_a","i","signMessage","response"],"sourceRoot":"","sources":["../../src/adapter.ts"],"sourcesContent":[null]},"metadata":{},"sourceType":"script"}